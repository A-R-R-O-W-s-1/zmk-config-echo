#include <physical_layouts.dtsi>

/ {
    kscan_left: kscan@0 {
        compatible = "zmk,kscan-gpio-matrix";
        wakeup-source;
        diode-direction = "col2row";
        row-gpios
            = <&pro_micro 0 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 1 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 16 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 2 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            ;
        col-gpios
            = <&pro_micro 21 GPIO_ACTIVE_HIGH>
            , <&pro_micro 9 GPIO_ACTIVE_HIGH>
            , <&pro_micro 19 GPIO_ACTIVE_HIGH>
            , <&pro_micro 18 GPIO_ACTIVE_HIGH>
            , <&pro_micro 15 GPIO_ACTIVE_HIGH>
            , <&pro_micro 14 GPIO_ACTIVE_HIGH>
            ;
    };

    kscan_right: kscan@1 {
        compatible = "zmk,kscan-gpio-matrix";
        wakeup-source;
        diode-direction = "col2row";
        row-gpios
            = <&pro_micro 0 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 1 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 16 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 2 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            ;
        col-gpios
            = <&pro_micro 14 GPIO_ACTIVE_HIGH>
            , <&pro_micro 15 GPIO_ACTIVE_HIGH>
            , <&pro_micro 18 GPIO_ACTIVE_HIGH>
            , <&pro_micro 19 GPIO_ACTIVE_HIGH>
            , <&pro_micro 20 GPIO_ACTIVE_HIGH>
            , <&pro_micro 21 GPIO_ACTIVE_HIGH>
            ;
    };

    default_layout: default_layout {
        compatible = "zmk,physical-layout";
        display-name = "Split Ergo Layout";
        kscan = <&kscan_left>, <&kscan_right>;
        keys  //                     w   h    x    y     rot    rx    ry
            // Left half - Outer column
            = <&key_physical_attrs 100 100    0    0       0     0     0>  // num
            , <&key_physical_attrs 100 100    0  100       0     0     0>  // top
            , <&key_physical_attrs 100 100    0  200       0     0     0>  // home
            , <&key_physical_attrs 100 100    0  300       0     0     0>  // bottom

            // Left half - Pinky column
            , <&key_physical_attrs 100 100  100    0       0     0     0>
            , <&key_physical_attrs 100 100  100  100       0     0     0>
            , <&key_physical_attrs 100 100  100  200       0     0     0>
            , <&key_physical_attrs 100 100  100  300       0     0     0>

            // Left half - Ring column (8.5 stagger)
            , <&key_physical_attrs 100 100  200    8.5     0     0     0>
            , <&key_physical_attrs 100 100  200  108.5     0     0     0>
            , <&key_physical_attrs 100 100  200  208.5     0     0     0>
            , <&key_physical_attrs 100 100  200  308.5     0     0     0>

            // Left half - Middle column (8 stagger)
            , <&key_physical_attrs 100 100  300    8       0     0     0>
            , <&key_physical_attrs 100 100  300  108       0     0     0>
            , <&key_physical_attrs 100 100  300  208       0     0     0>
            , <&key_physical_attrs 100 100  300  308       0     0     0>

            // Left half - Index column (-6.5 stagger)
            , <&key_physical_attrs 100 100  400   -6.5     0     0     0>
            , <&key_physical_attrs 100 100  400   93.5     0     0     0>
            , <&key_physical_attrs 100 100  400  193.5     0     0     0>
            , <&key_physical_attrs 100 100  400  293.5     0     0     0>

            // Left half - Inner column (-2 stagger)
            , <&key_physical_attrs 100 100  500   -2       0     0     0>
            , <&key_physical_attrs 100 100  500   98       0     0     0>
            , <&key_physical_attrs 100 100  500  198       0     0     0>
            , <&key_physical_attrs 100 100  500  298       0     0     0>

            // Left thumb cluster
            , <&key_physical_attrs 100 100  505  379     -20   505   379>  // Rotated thumb key
            , <&key_physical_attrs 100 100  500.5 379      0     0     0>  // Regular thumb key

            // Right half - Inner column (-2 stagger)
            , <&key_physical_attrs 100 100  700   -2       0     0     0>
            , <&key_physical_attrs 100 100  700   98       0     0     0>
            , <&key_physical_attrs 100 100  700  198       0     0     0>
            , <&key_physical_attrs 100 100  700  298       0     0     0>

            // Right half - Index column (-6.5 stagger)
            , <&key_physical_attrs 100 100  800   -6.5     0     0     0>
            , <&key_physical_attrs 100 100  800   93.5     0     0     0>
            , <&key_physical_attrs 100 100  800  193.5     0     0     0>
            , <&key_physical_attrs 100 100  800  293.5     0     0     0>

            // Right half - Middle column (8 stagger)
            , <&key_physical_attrs 100 100  900    8       0     0     0>
            , <&key_physical_attrs 100 100  900  108       0     0     0>
            , <&key_physical_attrs 100 100  900  208       0     0     0>
            , <&key_physical_attrs 100 100  900  308       0     0     0>

            // Right half - Ring column (8.5 stagger)
            , <&key_physical_attrs 100 100 1000    8.5     0     0     0>
            , <&key_physical_attrs 100 100 1000  108.5     0     0     0>
            , <&key_physical_attrs 100 100 1000  208.5     0     0     0>
            , <&key_physical_attrs 100 100 1000  308.5     0     0     0>

            // Right half - Pinky column
            , <&key_physical_attrs 100 100 1100    0       0     0     0>
            , <&key_physical_attrs 100 100 1100  100       0     0     0>
            , <&key_physical_attrs 100 100 1100  200       0     0     0>
            , <&key_physical_attrs 100 100 1100  300       0     0     0>

            // Right half - Outer column
            , <&key_physical_attrs 100 100 1200    0       0     0     0>
            , <&key_physical_attrs 100 100 1200  100       0     0     0>
            , <&key_physical_attrs 100 100 1200  200       0     0     0>
            , <&key_physical_attrs 100 100 1200  300       0     0     0>

            // Right thumb cluster
            , <&key_physical_attrs 100 100  695  379      20   695   379>  // Rotated thumb key
            , <&key_physical_attrs 100 100  699.5 379      0     0     0>  // Regular thumb key
            ;
    };
};